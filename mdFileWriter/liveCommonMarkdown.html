<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>We1 | Markdown Editor</title>
  <link rel="icon" href="../logo.png" type="image/x-icon">
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.0/darkly/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    :root {
      --sidebar-width: 280px;
      --toolbar-height: 60px;
      --accent-color: #ff2a00;
      --accent-sec-color: #93615785;
      --dark-bg: #1a1a1a;
      --darker-bg: #0d1117;
      --light-border: #30363d;
      --text-muted: #ffffff;
    }
    
    * {
        box-sizing: border-box; 
    }
    
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: var(--dark-bg);
      color: #f0f6fc;
      overflow: hidden;
    }
    
    /* Sidebar Styling */
    #sidebar {
      width: var(--sidebar-width);
      background: var(--darker-bg);
      border-right: 1px solid var(--light-border);
      display: flex;
      flex-direction: column;
      box-shadow: 2px 0 10px rgba(0,0,0,0.3);
    }
    
    .sidebar-header {
      padding: 0.68rem;
      border-bottom: 1px solid var(--light-border);
      background: linear-gradient(135deg, --var(--accent-color), --var(--accent-color) 50%, var(--darker-bg) 50%);
    }
    
    .sidebar-header h4 {
      margin: 0;
      color: white;
      font-weight: 600;
      font-size: 1.1rem;
    }
    
    .sidebar-actions {
      padding: 1rem;
      border-bottom: 1px solid var(--light-border);
    }
    
    .file-stats {
      padding: 0.5rem 1rem;
      font-size: 0.8rem;
      color: var(--text-muted);
      border-bottom: 1px solid var(--light-border);
    }
    
    #fileList {
      flex: 1;
      overflow-y: auto;
      padding: 0.5rem 0;
    }
    
    .file-item {
      padding: 0.25rem 0.1rem 0.25rem 0.3rem;
      cursor: pointer;
      border-left: 3px solid transparent;
      transition: all 0.2s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }
    
    .file-item:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .file-item.active {
      background: var(--accent-sec-color) ;
      border-left-color: var(--accent-color);
      color: var(--accent-color);
    }
    
    .file-actions {
      opacity: 0.3;
      transition: opacity 0.2s;
    }
    
    .file-item:hover .file-actions {
      opacity: 1;
    }
    
    .file-actions button {
      background: none;
      border: none;
      color: var(--text-muted);
      padding: 2px 4px;
      border-radius: 3px;
      font-size: 0.8rem;
      cursor: pointer;
    }
    
    .file-actions button:hover {
      background: rgba(255,255,255,0.1);
      color: var(--accent-color);
    }
    
    /* Main Area */
    #main {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--dark-bg);
    }
    
    /* Enhanced Toolbar */
    #toolbar {
      height: var(--toolbar-height);
      padding: 0.5rem 1rem;
      background: var(--darker-bg);
      border-bottom: 1px solid var(--light-border);
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 6px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    
    .toolbar-group {
      display: flex;
      gap: 4px;
      padding-right: 8px;
      border-right: 1px solid var(--light-border);
      margin-right: 8px;
    }
    
    .toolbar-group:last-child {
      border-right: none;
      margin-right: 0;
    }
    
    .btn-toolbar {
      padding: 6px 6px;
      font-size: 0.85rem;
      border: 1px solid var(--light-border);
      background: rgba(255,255,255,0.05);
      color: var(--text-muted);
      border-radius: 4px;
      transition: all 0.2s ease;
      cursor: pointer;
      align-items: center;
    }
    
    .btn-toolbar:hover {
      background: rgba(255,255,255,0.1);
      border-color: var(--accent-color);
      transform: translateY(-1px);
    }
    
    /* Editor Container */
    #editor-container {
      overflow: hidden;
      position: relative;
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: 49.9%;
      gap: 2px;
    }
    
    .editor-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
    }
    
    .panel-header {
      padding: 0.5rem 1rem;
      background: var(--darker-bg);
      border-bottom: 1px solid var(--light-border);
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0.1px;
    }
    
    .panel-controls {
      display: flex;
      gap: 8px;
    }
    
    .panel-btn {
      background: none;
      border: 1px solid var(--light-border);
      color: var(--text-muted);
      padding: 0px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .panel-btn:hover, .panel-btn.active {
      background: var(--accent-color);
      color: white;
      border-color: var(--accent-color);
    }
    
    #editor {
      border-right: 1px solid var(--light-border);
    }

    #currentFileName {
      color: var(---text-muted);
    }

    #modifiedStatus{
      color: var(--accent-sec-color);
    }
    
    #modifiedStatus.modified {
      color: yellow;
      animation: blink 0.6s infinite;
    }

    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0; }
      100% { opacity: 1; }
    }
    #modifiedStatus.saved {
      color: #00ff00;
    }

    #editor textarea {
      width: 100%;
      height: 87vh;
      border: none;
      resize: none;
      outline: none;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
      font-size: 14px;
      line-height: 1.6;
      padding: 1rem;
      background: var(--dark-bg);
      color: #f0f6fc;
      tab-size: 2;
    }
    
    #editor textarea::selection {
      background: rgba(0,123,255,0.3);
    }
    
    #preview {
      background: var(--dark-bg);
      padding: 0rem 0.5rem 0rem 0rem;
      overflow-y: auto;
      line-height: 1.6;
    }
    
    /* Preview Content Styling */
    #preview h1, #preview h2, #preview h3, #preview h4, #preview h5, #preview h6 {
      color: #58a6ff;
      border-bottom: 1px solid var(--light-border);
      padding-bottom: 0.3rem;
      margin-top: 1.5rem;
      margin-bottom: 1rem;
    }
    
    #preview blockquote {
      border-left: 4px solid var(--accent-color);
      padding-left: 1rem;
      margin: 0.1rem 0;
      background: rgba(0,123,255,0.1);
      padding: 0.1rem 1rem;
      border-radius: 4px;
    }
    
    #preview code {
      background: var(--darker-bg);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'JetBrains Mono', monospace;
      color: #ff7b72;
    }
    
    #preview pre {
      background: var(--darker-bg);
      border: 1px solid var(--light-border);
      border-radius: 4px;
      padding: 1rem;
      overflow-x: auto;
    }
    
    #preview pre code {
      background: none;
      padding: 0;
      color: var(--text-muted);
    }
    
    #preview table {
      border-collapse: collapse;
      width: 100%;
      margin: 1rem 0;
      border: 1px solid var(--light-border);
      border-radius: 4px;
    }
    
    #preview th, #preview td {
      border: 1px solid var(--light-border);
      padding: 0.25rem;
      text-align: left;
    }
    
    #preview th {
      background: var(--darker-bg);
      font-weight: 600;
      color:var(--accent-color)
    }
    
    #preview tr:nth-child(even) {
      background: rgba(255,255,255,0.02);
    }
    
    /* Search Bar */
    .search-container {
      position: relative;
    }
    
    .search-input {
      background: var(--darker-bg);
      border: 1px solid var(--light-border);
      color: #f0f6fc;
      padding: 6px 12px;
      border-radius: 4px;
      width: 200px;
      font-size: 0.9rem;
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 2px rgba(0,123,255,0.2);
    }
    
    /* Word Count & Status */
    .status-bar {
      padding: 0.5rem 1rem;
      background: var(--darker-bg);
      border-top: 1px solid var(--light-border);
      font-size: 0.8rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      :root { --sidebar-width: 0px; }
      #sidebar { transform: translateX(-100%); position: fixed; z-index: 1000; height: 100vh; }
      #sidebar.show { transform: translateX(0); }
      .mobile-menu-btn { display: block !important; }
    }
    
    .mobile-menu-btn {
      display: none;
      background: var(--accent-color);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    p{
      margin-bottom: 0px;
    }
    
    /* Light Mode */
    .light-mode {
      --dark-bg: #ffffff;
      --darker-bg: #f6f8fa;
      --light-border: #d1d9e0;
      --text-muted: #656d76;
      color: #1f2328;
    }
    
    .light-mode #editor textarea {
      background: #ffffff;
      color: #1f2328;
    }
    
    .light-mode #preview h1, .light-mode #preview h2, .light-mode #preview h3,
    .light-mode #preview h4, .light-mode #preview h5, .light-mode #preview h6 {
      color: #0969da;
    }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: var(--darker-bg); }
    ::-webkit-scrollbar-thumb { background: var(--light-border); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
  </style>
</head>
<body>
  <div id="sidebar">
    <div class="sidebar-header">
      <span class="navbar-brand fw-bold" style="display: flex;align-items: center;gap: 10px;">
        <img src="../logo.png" width="30" style="background: #ff000082;padding: 1px;border-radius: 4px;" />
        <strong>Markdown</strong>
      </span>
    </div>
    
    <div class="sidebar-actions">
      <button class="btn btn-primary btn-sm w-100 mb-2" onclick="newFile()">
        <i class="fas fa-plus"></i> New File
      </button>
      <div class="row g-1">
        <div class="col-6">
          <button class="btn btn-secondary btn-sm w-100" onclick="importFile()">
            <i class="fas fa-upload"></i> Import
          </button>
        </div>
        <div class="col-6">
          <button class="btn btn-outline-secondary btn-sm w-100" onclick="toggleTheme()">
            <i class="fas fa-adjust"></i> Theme
          </button>
        </div>
      </div>
    </div>
    
    <div class="file-stats">
      <span id="fileCount">0 files</span> • 
      <span id="wordCount">0 words</span>
    </div>
    
    <ul id="fileList" class="list-unstyled mb-0"></ul>
  </div>
  
  <div id="main">
    <div id="toolbar">
      <button class="mobile-menu-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
      </button>
      
      <div class="toolbar-group">
        <button class="btn-toolbar" onclick="insertSym('**','**')" title="Bold">
          <i class="fas fa-bold"></i>
        </button>
        <button class="btn-toolbar" onclick="insertSym('_','_')" title="Italic">
          <i class="fas fa-italic"></i>
        </button>
        <button class="btn-toolbar" onclick="insertSym('~~','~~')" title="Strikethrough">
          <i class="fas fa-strikethrough"></i>
        </button>
        <button class="btn-toolbar" onclick="insertSym('`','`')" title="Highlight">
          <i class="fas fa-highlighter"></i>
        </button>
      </div>
      
      <div class="toolbar-group">
        <button class="btn-toolbar" onclick="insertSym('# ','')">H1</button>
        <button class="btn-toolbar" onclick="insertSym('## ','')">H2</button>
        <button class="btn-toolbar" onclick="insertSym('### ','')">H3</button>
        <button class="btn-toolbar" onclick="insertSym('#### ','')">H4</button>
        <button class="btn-toolbar" onclick="insertSym('##### ','')">H5</button>
        <button class="btn-toolbar" onclick="insertSym('###### ','')">H6</button>
      </div>
      
      <div class="toolbar-group">
        <button class="btn-toolbar" onclick="insertSym('> ','')">
          <i class="fas fa-quote-left"></i>
        </button>
        <button class="btn-toolbar" onclick="insertSym('- ','')">
          <i class="fas fa-list-ul"></i>
        </button>
        <button class="btn-toolbar" onclick="insertSym('1. ','')">
          <i class="fas fa-list-ol"></i>
        </button>
        <button class="btn-toolbar" onclick="insertSym('- [ ] ','')">
          <i class="fas fa-tasks"></i>
        </button>
      </div>
      
      <div class="toolbar-group">
        <button class="btn-toolbar" onclick="insertSym('```\n','\n```')">
          <i class="fas fa-file-code"></i>
        </button>
        <button class="btn-toolbar" onclick="insertLink()">
          <i class="fas fa-link"></i>
        </button>
        <button class="btn-toolbar" onclick="insertImage()">
          <i class="fas fa-image"></i>
        </button>
      </div>
      
      <div class="toolbar-group">
        <button class="btn-toolbar" onclick="insertTable()">
          <i class="fas fa-table"></i>
        </button>
        <button class="btn-toolbar" onclick="insertSym('--- ','')">
          <i class="fas fa-minus"></i>
        </button>
      </div>
      
      <div class="toolbar-group">
        <button class="btn-toolbar" onclick="saveAll()" title="Save All">
          <i class="fas fa-save"></i>
        </button>
        <button class="btn-toolbar" onclick="exportMD()" title="Export MD">
          <i class="fas fa-download"></i> MD
        </button>
        <button class="btn-toolbar" onclick="exportHTML()" title="Export HTML">
          <i class="fab fa-html5"></i> HTML
        </button>
        <button class="btn-toolbar" onclick="copyHTML()" title="Copy HTML">
          <i class="fas fa-copy"></i>HTML
        </button>
      </div>
      
      <!-- <div class="search-container">
        <input type="text" class="search-input" placeholder="Search & replace..." 
               oninput="searchContent(this.value)" onkeypress="handleSearchKey(event)"/>
      </div> -->
    </div>
    
    <div id="editor-container">
      <div class="editor-panel" id="editor">
        <div class="panel-header">
          <span><i class="fas fa-edit"></i> Editor</span>
          <div class="panel-controls">
            <button class="panel-btn" onclick="toggleWrap()" title="Word Wrap">
              <i class="fas fa-text-width"></i>
            </button>
            <button class="panel-btn" onclick="clearThis()" title="Clear">
              <i class="fas fa-trash"></i>
            </button>
            <button class="panel-btn" onclick="" title="File Status">
              <span id="modifiedStatus">Saved</span>
            </button>

          </div>
        </div>
        <textarea id="markdown" placeholder="Start writing your markdown here..."></textarea>
      </div>
      
      <div class="editor-panel" id="preview">
        <div class="panel-header">
          <span><i class="fas fa-eye"></i> Preview</span>
          
        </div>
        <div id="preview-content"></div>
      </div>
    </div>
    
    <div class="status-bar">
      <div class="status-left">
        <span id="currentFileName">Untitled</span>
      </div>
      <div class="status-right">
        <span id="lineCount">1 line</span> •
        <span id="charCount">0 characters</span> •
        <span id="liveWordCount">0 words</span>
      </div>
    </div>
  </div>

  <input type="file" id="fileInput" accept=".md,.txt" style="display:none" onchange="handleFileImport(event)"/>

<script>
  const STORAGE = 'pmd_files_v2';
  let files = JSON.parse(localStorage.getItem(STORAGE) || '{}');
  let current = '';
  let searchQuery = '';
  let currentMode = 'split';
  let isModified = false;

  // Initialize markdown renderer
  marked.setOptions({
    breaks: true,
    gfm: true,
    headerIds: true,
    mangle: false
  });

  // Initialize app
  window.onload = function() {
    // Load theme
    if (localStorage.getItem('theme') === 'light') {
      document.body.classList.add('light-mode');
    }
    
    // Load files or create default
    if (Object.keys(files).length) {
      current = Object.keys(files)[0];
      refreshSidebar();
      loadFile();
    } else {
      newFile();
    }
    
    // Setup auto-save
    setInterval(autoSave, 5000);
    
    // Setup editor events
    const textarea = document.getElementById('markdown');
    textarea.addEventListener('input', handleEditorChange);
    textarea.addEventListener('scroll', syncScroll);
    
    // Keyboard shortcuts
    document.addEventListener('keydown', handleKeyboardShortcuts);
  };

  function refreshSidebar() {
    const list = document.getElementById('fileList');
    list.innerHTML = '';
    
    const fileNames = Object.keys(files).sort();
    
    for (let name of fileNames) {
      const li = document.createElement('li');
      li.className = 'file-item' + (name === current ? ' active' : '');
      
      li.innerHTML = '<span class="file-name" onclick="switchFile(\'' + name + '\')">' + name + '</span>' +
        '<div class="file-actions">' +
          '<button onclick="renameFile(\'' + name + '\')" title="Rename">' +
            '<i class="fas fa-edit"></i>' +
          '</button>' +
          '<button onclick="duplicateFile(\'' + name + '\')" title="Duplicate">' +
            '<i class="fas fa-copy"></i>' +
          '</button>' +
          '<button onclick="deleteFile(\'' + name + '\')" title="Delete">' +
            '<i class="fas fa-trash"></i>' +
          '</button>' +
        '</div>';
      
      list.append(li);
    }
    
    updateFileStats();
  }

  function updateFileStats() {
    const fileCount = Object.keys(files).length;
    document.getElementById('fileCount').textContent = fileCount + ' file' + (fileCount !== 1 ? 's' : '');
    
    const content = files[current] || '';
    const wordCount = content.trim() ? content.trim().split(/\s+/).length : 0;
    document.getElementById('wordCount').textContent = wordCount + ' word' + (wordCount !== 1 ? 's' : '');
  }

  function newFile() {
    const name = prompt('File name:') || ('untitled_' + Date.now());
    if (files[name]) {
      alert('File already exists!');
      return;
    }
    files[name] = '';
    current = name;
    refreshSidebar();
    loadFile();
    updateStatus();
  }

  function switchFile(name) {
    saveCurrent();
    current = name;
    refreshSidebar();
    loadFile();
    updateStatus();
  }

  function renameFile(oldName) {
    const newName = prompt('New name:', oldName);
    if (!newName || newName === oldName) return;
    if (files[newName]) {
      alert('File already exists!');
      return;
    }
    
    files[newName] = files[oldName];
    delete files[oldName];
    if (current === oldName) current = newName;
    refreshSidebar();
    updateStatus();
  }

  function duplicateFile(name) {
    const newName = prompt('New name:', name + '_copy');
    if (!newName || files[newName]) {
      alert('Invalid name or file already exists!');
      return;
    }
    files[newName] = files[name];
    refreshSidebar();
  }

  function deleteFile(name) {
    if (!confirm('Delete "' + name + '"?')) return;
    delete files[name];
    
    if (current === name) {
      const remaining = Object.keys(files);
      if (remaining.length > 0) {
        current = remaining[0];
        loadFile();
      } else {
        newFile();
        return;
      }
    }
    refreshSidebar();
    updateStatus();
  }

  function saveCurrent() {
    if (current) {
      files[current] = document.getElementById('markdown').value;
      isModified = false;
      updateStatus();
    }
  }

  function loadFile() {
    const content = files[current] || '';
    document.getElementById('markdown').value = content;
    updatePreview();
    updateStatus();
    updateStats();
  }

  function saveAll() {
    saveCurrent();
    localStorage.setItem(STORAGE, JSON.stringify(files));
    showToast('All files saved!', 'success');
  }

  function autoSave() {
    if (isModified) {
      saveCurrent();
      localStorage.setItem(STORAGE, JSON.stringify(files));
    }
  }

  function handleEditorChange() {
    isModified = true;
    updatePreview();
    updateStatus();
    updateStats();
  }

  function updateStatus() {
    document.getElementById('currentFileName').textContent = current || 'Untitled';
    document.getElementById('modifiedStatus').textContent = isModified ? 'Modified' : 'Saved';
    document.getElementById('modifiedStatus').className = isModified ? 'modified' : 'saved';
  }

  function updateStats() {
    const content = document.getElementById('markdown').value;
    const lines = content.split('\n').length;
    const chars = content.length;
    const words = content.trim() ? content.trim().split(/\s+/).length : 0;
    
    document.getElementById('lineCount').textContent = lines + ' line' + (lines !== 1 ? 's' : '');
    document.getElementById('charCount').textContent = chars + ' character' + (chars !== 1 ? 's' : '');
    document.getElementById('liveWordCount').textContent = words + ' word' + (words !== 1 ? 's' : '');
    
    updateFileStats();
  }

  function insertSym(start, end) {
    const textarea = document.getElementById('markdown');
    const selStart = textarea.selectionStart;
    const selEnd = textarea.selectionEnd;
    const value = textarea.value;
    const selected = value.slice(selStart, selEnd);
    
    const newText = start + selected + end;
    textarea.value = value.slice(0, selStart) + newText + value.slice(selEnd);
    
    // Set cursor position
    const newPos = selStart + start.length + selected.length;
    textarea.setSelectionRange(newPos, newPos);
    textarea.focus();
    
    handleEditorChange();
  }

  function insertTable() {
    const rows = prompt('Number of rows:', '3') || '3';
    const cols = prompt('Number of columns:', '3') || '3';
    
    let table = '';
    
    // Header row
    table += '|';
    for (let i = 0; i < parseInt(cols); i++) {
      table += ' Header ' + (i + 1) + ' |';
    }
    table += '\n';
    
    // Separator row
    table += '|';
    for (let i = 0; i < parseInt(cols); i++) {
      table += ' --- |';
    }
    table += '\n';
    
    // Data rows
    for (let row = 0; row < parseInt(rows) - 1; row++) {
      table += '|';
      for (let col = 0; col < parseInt(cols); col++) {
        table += ' Cell ' + (row + 1) + '-' + (col + 1) + ' |';
      }
      table += '\n';
    }
    
    insertSym(table, '');
  }

  function insertLink() {
    const text = prompt('Link text:', 'Link');
    const url = prompt('URL:', 'https://');
    if (text && url) {
      insertSym('[' + text + '](' + url + ')', '');
    }
  }

  function insertImage() {
    const alt = prompt('Alt text:', 'Image');
    const url = prompt('Image URL:', 'https://');
    if (alt && url) {
      insertSym('![' + alt + '](' + url + ')', '');
    }
  }

  function updatePreview() {
    const content = document.getElementById('markdown').value;
    document.getElementById('preview-content').innerHTML = marked.parse(content);
    syncScroll();
  }

  function syncScroll() {
    const editor = document.querySelector('#editor textarea');
    const preview = document.getElementById('preview-content');
    
    if (editor && preview) {
      const scrollRatio = editor.scrollTop / (editor.scrollHeight - editor.clientHeight);
      preview.scrollTop = scrollRatio * (preview.scrollHeight - preview.clientHeight);
    }
  }

  function togglePreviewMode(mode) {
    currentMode = mode;
    const editor = document.getElementById('editor');
    const preview = document.getElementById('preview');
    
    // Reset classes
    editor.style.display = 'flex';
    preview.style.display = 'flex';
    
    // Update button states
    document.querySelectorAll('.panel-btn').forEach(function(btn) { 
      btn.classList.remove('active'); 
    });
    
    switch (mode) {
      case 'editor':
        preview.style.display = 'none';
        document.getElementById('editor-btn').classList.add('active');
        break;
      case 'preview':
        editor.style.display = 'none';
        document.getElementById('preview-btn').classList.add('active');
        break;
      case 'split':
        document.getElementById('split-btn').classList.add('active');
        break;
    }
  }

  function toggleTheme() {
    document.body.classList.toggle('light-mode');
    const isLight = document.body.classList.contains('light-mode');
    localStorage.setItem('theme', isLight ? 'light' : 'dark');
    showToast('Switched to ' + (isLight ? 'light' : 'dark') + ' mode', 'info');
  }

  function importFile() {
    document.getElementById('fileInput').click();
  }

  function handleFileImport(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
      const name = file.name.replace(/\.[^/.]+$/, "") || 'imported_file';
      const uniqueName = getUniqueName(name);
      files[uniqueName] = e.target.result;
      current = uniqueName;
      refreshSidebar();
      loadFile();
      showToast('Imported "' + uniqueName + '"', 'success');
    };
    reader.readAsText(file);
  }

  function getUniqueName(baseName) {
    if (!files[baseName]) return baseName;
    
    let counter = 1;
    let newName = baseName + '_' + counter;
    while (files[newName]) {
      counter++;
      newName = baseName + '_' + counter;
    }
    return newName;
  }

  function exportMD() {
    saveCurrent();
    const content = files[current] || '';
    const blob = new Blob([content], { type: 'text/markdown' });
    downloadBlob(blob, current + '.md');
    showToast('Markdown exported!', 'success');
  }

  function exportHTML() {
    saveCurrent();
    const content = files[current] || '';

    const html = `
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>${current}</title>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />
      <style>
        *, *::before, *::after {
          box-sizing: border-box; margin: 0; padding: 0; 
        }
        .article-wrap {
          background: #ffffff;
          width: 100%;
          box-shadow: 0 25px 60px rgba(0, 0, 0, 0.08);
          padding: 3rem 3.5rem;
          position: relative;
          overflow: hidden;
          animation: drop-in 0.7s ease-out;
        }
        body.simpletheme {
          font-family: 'Source Sans Pro', sans-serif;
          background: linear-gradient(135deg, #f0f4ff 0%, #e0e8ff 100%);
          color: #1f2937;
          min-height: 100vh;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        @keyframes drop-in {
          from { opacity: 0; transform: translateY(40px); }
          to { opacity: 1; transform: translateY(0); }
        }

        /* === Stylish Header === */
        .simpletheme h1 {
          font-family: 'Playfair Display', serif;
          font-size: 2.8rem;
          line-height: 1.2;
          color: #111827;
          margin-bottom: 1.5rem;
          position: relative;
          padding-bottom: 0.5rem;
          text-align: center;
        }
        .simpletheme h1::after {
          content: '';
          height: 4px;
          width: 60px;
          background: #3b82f6;
          position: absolute;
          bottom: 0;
          left: 50%;
          transform: translateX(-50%);
          border-radius: 4px;
        }

        /* === Section Headings === */
        .simpletheme h2 {
          font-size: 1.8rem;
          margin: 2.5rem 0 1rem;
          color: #1e293b;
          border-bottom: 2px dashed #e2e8f0;
          padding-bottom: 0.3rem;
        }

        /* === Paragraphs & Links === */
        .simpletheme p {
          font-size: 1.05rem;
          line-height: 1.7;
          color: #374151;
        }
        .simpletheme a {
          color: #3b82f6;
          text-decoration: none;
          position: relative;
          font-weight: 600;
        }
        .simpletheme a::after {
          content: '';
          height: 2px;
          width: 0;
          background: #3b82f6;
          position: absolute;
          left: 0;
          bottom: -2px;
          transition: width 0.3s ease;
          border-radius: 1px;
        }
        .simpletheme a:hover::after { width: 100%; }

        /* === Blockquotes with Flair === */
        .simpletheme blockquote {
          border-left: 5px solid #3b82f6;
          background: #e0f2fe;
          padding: 0rem 1.5rem;
          font-style: italic;
          color: #1e3a8a;
          margin: 2rem 0 1.5rem;
          border-radius: 8px;
          position: relative;
          transition: transform 0.3s;
        }
        .simpletheme blockquote:hover { transform: translateX(5px); }

        /* === Code Blocks with Shine === */
        .simpletheme pre {
          background: #111827;
          color: #f5f5f5;
          padding: 1.4rem;
          border-radius: 10px;
          overflow-x: auto;
          margin: 2rem 0;
          font-family: 'Source Code Pro', monospace;
          position: relative;
          box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.4);
        }
        .simpletheme pre::before {
          content: ' ';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(90deg, #3b82f6, #0ea5e9, #3b82f6);
          border-radius: 10px 10px 0 0;
        }
        .simpletheme  code { 
          font-family: 'Source Code Pro', monospace;
          color: red;
          background: #ffffe8;
          padding: 4px;
          border-radius: 8px;
        }
        .simpletheme pre code { 
          color: #00ffbf;
          background: unset;
        }

        /* === Lists === */
        .simpletheme ul,.simpletheme  ol {
          margin: 1rem 0 1rem 2rem;
        }
        .simpletheme li { margin-bottom: 0.6rem; }

        /* === Tables === */
        .simpletheme  table {
          width: 100%;
          border-collapse: collapse;
          margin: 2rem 0;
          font-size: 1rem;
        }
        .simpletheme th,.simpletheme  td {
          border: 1px solid #e2e8f0;
          padding: 0.75rem 1rem;
          text-align: left;
        }
        .simpletheme th {
          background: #f1f5f9;
          font-weight: 600;
        }

        /* === Images with Depth === */
        .simpletheme img {
          display: block;
          max-width: 100%;
          margin: 2rem 0;
          border-radius: 14px;
          box-shadow: 0 15px 25px rgba(0,0,0,0.1);
          transition: transform 0.3s;
        }
        .simpletheme img:hover { transform: translateY(-5px) scale(1.02); }

        .simpletheme hr {
          border: none;
          border-top: 1px solid #e2e8f0;
          margin: 3rem 0;
        }

        /* === Footer (Centered Mentality) === */
        .simpletheme .footer {
          margin-top: 3rem;
          text-align: center;
          color: #6b7280;
          font-size: 0.95rem;
        }

        /* === Responsive Tweaks === */
        @media (max-width: 640px) {
          .simpletheme .article-wrap {
            padding: 2rem;
            border-radius: 12px;
          }
          .simpletheme h1 { font-size: 2.2rem; }
          .simpletheme h2 { font-size: 1.6rem; }
          .simpletheme pre { font-size: 0.9rem; }
        }

        
        /* ===== CSS Variables for themes ===== */
        :root {
          /* Shared typography */
          --font-body: 'Inter', sans-serif;
          --font-heading: 'Playfair Display', serif;
          --border-radius: 4px;
          --transition-speed: 0.3s;

          /* Light1 theme (default) */
          --bg-color: #fafafa;
          --text-color: #222222;
          --heading-color: #111111;
          --accent-color: #0077ff;
          --blockquote-bg: #e6f0ff;
          --blockquote-border: var(--accent-color);
          --code-bg: #f3f4f6;
          --code-text: #c7254e;
          --code-border: transparent;
          --img-shadow: rgba(0, 119, 255, 0.3);
          --container-bg: #ffffff;
          --container-shadow: rgba(0, 0, 0, 0.12);
        }

        /* Light2 theme */
        body.advtheme.light2 {
          --bg-color: #f0f0f3;
          --text-color: #4b4b4b;
          --heading-color: #3a3a3a;
          --accent-color: #ff6f61;
          --blockquote-bg: #f0f0f3;
          --blockquote-border: var(--accent-color);
          --code-bg: #f0f0f3;
          --code-text: #ff6f61;
          --code-border: transparent;
          --img-shadow: rgba(255, 111, 97, 0.4);
          --container-bg: #f0f0f3;
          --container-shadow: #c1c1c1;
        }

        /* Light3 theme (Glassmorphism) */
        body.advtheme.light3 {
          --bg-color: linear-gradient(135deg, #e0f7fa 20%, #fff 90%);
          --text-color: #1a1a1add;
          --heading-color: #0097a7;
          --accent-color: #0097a7;
          --blockquote-bg: rgba(255 255 255 / 0.4);
          --blockquote-border: var(--accent-color);
          --code-bg: rgba(255 255 255 / 0.4);
          --code-text: var(--accent-color);
          --code-border: 1.5px solid var(--accent-color);
          --img-shadow: rgba(0, 151, 167, 0.15);
          --container-bg: rgba(255 255 255 / 0.4);
          --container-shadow: rgba(0, 151, 167, 0.15);
        }

        /* Dark theme */
        body.advtheme.dark {
          --bg-color: #121212;
          --text-color: #ddd;
          --heading-color: #eee;
          --accent-color: #4dabf7;
          --blockquote-bg: #1e1e1e;
          --blockquote-border: var(--accent-color);
          --code-bg: #222;
          --code-text: #80cbc4;
          --code-border: transparent;
          --img-shadow: rgba(77, 171, 247, 0.6);
          --container-bg: #1e1e1e;
          --container-shadow: rgba(0, 0, 0, 0.8);
        }

        /* ===== Global base styles ===== */
        body.advtheme {
          margin: 0;
          padding: 2rem;
          background: var(--bg-color);
          color: var(--text-color);
          font-family: var(--font-body);
          transition:
            background-color var(--transition-speed) ease,
            color var(--transition-speed) ease;
          display: flex;
          justify-content: center;
          min-height: 100vh;
        }

        body.advtheme .container {
          background: var(--container-bg);
          box-shadow: 0 6px 20px var(--container-shadow);
          border-radius: var(--border-radius);
          padding: 3rem 3.5rem;
          max-width: 700px;
          width: 100%;
          transition: background-color var(--transition-speed),
                      box-shadow var(--transition-speed);
        }

        /* ===== Typography ===== */
        body.advtheme h1,
        body.advtheme h2,
        body.advtheme h3,
        body.advtheme h4,
        body.advtheme h5,
        body.advtheme h6 {
          font-family: var(--font-heading);
          color: var(--heading-color);
          margin-top: 2rem;
          margin-bottom: 1rem;
          line-height: 1.2;
          transition: color var(--transition-speed);
        }

        body.advtheme h1 {
          font-size: 3rem;
          font-weight: 700;
          border-bottom: 4px solid var(--accent-color);
          padding-bottom: 0.5rem;
          letter-spacing: 0.03em;
        }

        body.advtheme h2 {
          font-size: 2rem;
          font-weight: 600;
          border-bottom: 2px solid var(--accent-color);
          padding-bottom: 0.3rem;
        }

        body.advtheme p {
          font-size: 1.1rem;
        }

        /* ===== Blockquote ===== */
        body.advtheme blockquote {
          border-left: 8px solid var(--blockquote-border);
          background-color: var(--blockquote-bg);
          padding: 0.5rem 2rem;
          font-style: italic;
          border-radius: var(--border-radius);
          margin: 3rem 0;
          color: var(--accent-color);
          box-shadow: 2px 2px 10px var(--container-shadow);
          transition: transform var(--transition-speed);
        }

        body.advtheme blockquote:hover {
          transform: translateX(5px);
        }

        /* ===== Code blocks and inline code ===== */
        body.advtheme pre {
          position: relative;
          background-color: var(--code-bg);
          color: var(--code-text);
          padding: 1.6rem 2rem;
          border-radius: var(--border-radius);
          font-family: 'Courier New', Courier, monospace;
          font-size: 1rem;
          overflow-x: auto;
          box-shadow: inset 0 0 12px var(--container-shadow);
          margin: 3rem 0;
          user-select: all;
          transition: box-shadow var(--transition-speed);
        }
        body.advtheme pre:hover {
          box-shadow: inset 0 0 20px var(--accent-color);
        }

        body.advtheme code {
          background-color: var(--code-bg);
          padding: 0.25rem 0.5rem;
          border-radius: 8px;
          font-family: monospace;
          color: var(--code-text);
        }

        /* ===== Copy button on code blocks ===== */
        body.advtheme .copy-btn {
          position: absolute;
          top: 8px;
          right: 8px;
          background: var(--accent-color);
          border: none;
          color: white;
          padding: 0.3rem 0.6rem;
          font-size: 0.9rem;
          border-radius: 8px;
          cursor: pointer;
          opacity: 0.8;
          transition: opacity 0.3s ease;
          user-select: none;
          font-weight: 600;
          z-index: 10;
        }
        body.advtheme .copy-btn:hover {
          opacity: 1;
        }

        /* ===== Images ===== */
        body.advtheme img {
          width: 100%;
          border-radius: var(--border-radius);
          box-shadow: 0 15px 35px var(--img-shadow);
          margin: 2rem 0;
          transition: transform var(--transition-speed), box-shadow var(--transition-speed);
          cursor: pointer;
        }
        body.advtheme img:hover {
          transform: scale(1.05);
          box-shadow: 0 20px 50px var(--accent-color);
        }

        /* ===== Links ===== */
        body.advtheme a {
          color: var(--accent-color);
          text-decoration: none;
          transition: color var(--transition-speed);
        }
        body.advtheme a:hover {
          text-decoration: underline;
        }

        /* ===== Scrollbar styling for code ===== */
        body.advtheme pre::-webkit-scrollbar {
          height: 8px;
        }
        body.advtheme pre::-webkit-scrollbar-thumb {
          background-color: var(--accent-color);
          border-radius: 4px;
        }

  

      </style>

    </head>
    <body class="simpletheme">  
      <div class="article-wrap">
        ${marked.parse(content)}
      <div>
        <!-- scr -->
        <script>
           // Your JavaScript code here
           console.log('HTML exported!');
         <\\/script>
    </body>
    </html>
    `;

    const blob = new Blob([html], { type: 'text/html' });
    downloadBlob(blob, current + '.html');
    showToast('HTML exported!', 'success');
  }


  function copyHTML() {
    const content = document.getElementById('markdown').value;
    const html = marked.parse(content);
    navigator.clipboard.writeText(html).then(function() {
      showToast('HTML copied to clipboard!', 'success');
    }).catch(function() {
      showToast('Failed to copy HTML', 'error');
    });
  }

  function downloadBlob(blob, filename) {
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  function searchContent(query) {
    searchQuery = query.toLowerCase();
    const content = document.getElementById('markdown').value;
    
    if (!query) return;
    
    const index = content.toLowerCase().indexOf(searchQuery);
    if (index >= 0) {
      const textarea = document.getElementById('markdown');
      textarea.focus();
      textarea.setSelectionRange(index, index + query.length);
    }
  }

  function handleSearchKey(event) {
    if (event.key === 'Enter') {
      const query = event.target.value;
      if (event.shiftKey) {
        searchBackwards(query);
      } else {
        searchForwards(query);
      }
    }
  }

  function searchForwards(query) {
    const textarea = document.getElementById('markdown');
    const content = textarea.value.toLowerCase();
    const currentPos = textarea.selectionEnd;
    const index = content.indexOf(query.toLowerCase(), currentPos);
    
    if (index >= 0) {
      textarea.setSelectionRange(index, index + query.length);
    } else {
      const wrapIndex = content.indexOf(query.toLowerCase(), 0);
      if (wrapIndex >= 0) {
        textarea.setSelectionRange(wrapIndex, wrapIndex + query.length);
      }
    }
  }

  function searchBackwards(query) {
    const textarea = document.getElementById('markdown');
    const content = textarea.value.toLowerCase();
    const currentPos = textarea.selectionStart - 1;
    const index = content.lastIndexOf(query.toLowerCase(), currentPos);
    
    if (index >= 0) {
      textarea.setSelectionRange(index, index + query.length);
    } else {
      const wrapIndex = content.lastIndexOf(query.toLowerCase());
      if (wrapIndex >= 0) {
        textarea.setSelectionRange(wrapIndex, wrapIndex + query.length);
      }
    }
  }

  function toggleWrap() {
    const textarea = document.getElementById('markdown');
    if (textarea.style.whiteSpace === 'pre') {
      textarea.style.whiteSpace = 'pre-wrap';
      showToast('Word wrap enabled', 'info');
    } else {
      textarea.style.whiteSpace = 'pre';
      showToast('Word wrap disabled', 'info');
    }
  }

  function clearThis() {
    if (confirm('Clear current content?')) {
      document.getElementById('markdown').value = '';
      handleEditorChange();
    }
  }

  function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('show');
  }

  function handleKeyboardShortcuts(event) {
    if (event.ctrlKey || event.metaKey) {
      switch (event.key) {
        case 's':
          event.preventDefault();
          saveAll();
          break;
        case 'n':
          event.preventDefault();
          newFile();
          break;
        case 'b':
          event.preventDefault();
          insertSym('**', '**');
          break;
        case 'i':
          event.preventDefault();
          insertSym('_', '_');
          break;
        case 'k':
          event.preventDefault();
          insertLink();
          break;
        case 'e':
          event.preventDefault();
          exportMD();
          break;
        case '1':
          event.preventDefault();
          insertSym('# ', '');
          break;
        case '2':
          event.preventDefault();
          insertSym('## ', '');
          break;
        case '3':
          event.preventDefault();
          insertSym('### ', '');
          break;
      }
    }
    
    if (event.key === 'Escape') {
      document.getElementById('sidebar').classList.remove('show');
    }
  }

  function showToast(message, type) {
    type = type || 'info';
    const toast = document.createElement('div');
    toast.className = 'toast toast-' + type;
    toast.style.cssText = 'position: fixed; top: 20px; right: 20px; background: ' + 
      (type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#007bff') + 
      '; color: white; padding: 12px 20px; border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 10000; transform: translateX(100%); transition: transform 0.3s ease; font-size: 0.9rem; max-width: 300px;';
    toast.textContent = message;
    
    document.body.appendChild(toast);
    
    setTimeout(function() {
      toast.style.transform = 'translateX(0)';
    }, 100);
    
    setTimeout(function() {
      toast.style.transform = 'translateX(100%)';
      setTimeout(function() {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 300);
    }, 3000);
  }

  // Prevent data loss on page unload
  window.addEventListener('beforeunload', function(event) {
    if (isModified) {
      event.preventDefault();
      event.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
      return event.returnValue;
    }
  });

  // Handle paste events for images
  document.getElementById('markdown').addEventListener('paste', function(event) {
    const items = event.clipboardData.items;
    for (let i = 0; i < items.length; i++) {
      const item = items[i];
      if (item.type.indexOf('image') !== -1) {
        event.preventDefault();
        const file = item.getAsFile();
        const reader = new FileReader();
        reader.onload = function(e) {
          const dataUrl = e.target.result;
          insertSym('![Pasted Image](' + dataUrl + ')', '');
          showToast('Image pasted from clipboard!', 'success');
        };
        reader.readAsDataURL(file);
        break;
      }
    }
  });

  // Auto-save on visibility change
  document.addEventListener('visibilitychange', function() {
    if (document.hidden && isModified) {
      autoSave();
    }
  });
  </script>
</body>
</html>