<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Notes Manager — Points, Tables & Flashcards</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
  <!-- jQuery (for convenience) -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    :root{--accent:#4f46e5}
    body{background:#f7f7fb}
    .sidebar{height:100vh;overflow:auto}
    .tag-badge{cursor:pointer}
    .card-flip{perspective:1000px}
    .card-inner{transition:transform .6s;transform-style:preserve-3d}
    .card.flip .card-inner{transform:rotateY(180deg)}
    .card-front,.card-back{backface-visibility:hidden;position:absolute;left:0;top:0;width:100%;height:100%}
    .card-back{transform:rotateY(180deg);padding:1rem}
    .note-type-pill{font-size:.7rem}
    .table-small td, .table-small th{padding:.35rem}
    .monospace{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Monospace}
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="row g-0">
    <aside class="col-12 col-md-3 col-lg-2 border-end bg-white sidebar p-3">
      <h5 class="mb-3"><i class="fa-solid fa-sticky-note"></i> Notes Manager</h5>

      <div class="mb-3">
        <button class="btn btn-primary w-100 mb-2" id="btnAddNote"><i class="fa-solid fa-plus"></i> Add Note</button>
        <div class="d-grid gap-2">
          <button class="btn btn-outline-secondary" id="btnImport">Import</button>
          <button class="btn btn-outline-secondary" id="btnExport">Export</button>
          <button class="btn btn-outline-success" id="btnTakeTest"><i class="fa-solid fa-check"></i> Take Test</button>
        </div>
      </div>

      <div class="mb-3">
        <input class="form-control" id="searchInput" placeholder="Search notes or tags...">
      </div>

      <div class="mb-2"><strong>Tags</strong> <small class="text-muted">(click to filter)</small></div>
      <div id="tagsList" class="mb-3 d-flex flex-wrap gap-2"></div>

      <hr>
      <div class="text-muted small">Storage: <span id="storageInfo">—</span></div>
      <div class="text-muted small">LocalStorage key: <code class="monospace">notes_manager_storage</code></div>
      <div class="mt-3 text-muted small">Quick help: Add notes as <em>Point</em>, <em>Table</em> (paste CSV), or <em>Flashcard</em>. Use tags to group and run tests.</div>
    </aside>

    <main class="col-12 col-md-9 col-lg-10 p-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h4 id="viewTitle">All Notes</h4>
          <small class="text-muted" id="viewSubtitle">Showing everything</small>
        </div>
        <div>
          <div class="btn-group" role="group">
            <button class="btn btn-outline-primary view-mode active" data-mode="list">List</button>
            <button class="btn btn-outline-primary view-mode" data-mode="table">Tables</button>
            <button class="btn btn-outline-primary view-mode" data-mode="flash">Flashcards</button>
          </div>
        </div>
      </div>

      <div id="notesArea"></div>

    </main>
  </div>
</div>

<!-- Add/Edit Note Modal -->
<div class="modal fade" id="noteModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="noteForm">
        <div class="modal-header">
          <h5 class="modal-title">Add Note</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="noteId">

          <div class="mb-3">
            <label class="form-label">Type</label>
            <select class="form-select" id="noteType">
              <option value="point">Point (simple bullet)</option>
              <option value="table">Table (CSV paste)</option>
              <option value="flash">Flashcard (question/answer)</option>
            </select>
          </div>

          <div class="mb-3" id="fieldPoint">
            <label class="form-label">Text (points / bullets)</label>
            <textarea class="form-control" id="noteText" rows="3" placeholder="Write bullet points, each on a new line"></textarea>
          </div>

          <div class="mb-3 d-none" id="fieldTable">
            <label class="form-label">CSV (first row = headers). Paste CSV or enter rows separated by new line.</label>
            <textarea class="form-control" id="noteTable" rows="6" placeholder="name,age\nAlice,30\nBob,25"></textarea>
            <div class="form-text">Tip: simple CSV only. Commas separate columns.</div>
          </div>

          <div class="mb-3 d-none" id="fieldFlash">
            <label class="form-label">Question</label>
            <input class="form-control" id="noteQuestion" placeholder="Question / prompt">
            <label class="form-label mt-2">Answer</label>
            <textarea class="form-control" id="noteAnswer" rows="3" placeholder="Answer / explanation"></textarea>
          </div>

          <div class="mb-3">
            <label class="form-label">Tags (comma separated)</label>
            <input class="form-control" id="noteTags" placeholder="math, exam, vocabulary">
          </div>

          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" id="pinNote">
            <label class="form-check-label" for="pinNote">Pin note (keeps it near the top)</label>
          </div>

          <div class="small text-muted">Notes are stored in your browser's localStorage. Export to backup or import to restore/merge.</div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
          <button class="btn btn-primary" type="submit">Save Note</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Import Modal -->
<div class="modal fade" id="importModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Import Notes (JSON)</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>Paste JSON exported from this app or a compatible structure. You may choose to merge or replace your current notes.</p>
        <textarea id="importText" class="form-control" rows="10" placeholder='[ {"id":"...","type":"flash","question":"...","answer":"...","tags":["..."],"pinned":false} ]'></textarea>
        <div class="mt-3">
          <div class="form-check">
            <input class="form-check-input" type="radio" name="importMode" id="importMerge" value="merge" checked>
            <label class="form-check-label" for="importMerge">Merge (keep existing, add/overwrite by id)</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" name="importMode" id="importReplace" value="replace">
            <label class="form-check-label" for="importReplace">Replace (overwrite local storage completely)</label>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" id="doImport">Import</button>
      </div>
    </div>
  </div>
</div>

<!-- Test Modal -->
<div class="modal fade" id="testModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Take a Test</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Select tags to include (click tags on left or type comma-separated)</label>
          <input class="form-control" id="testTags" placeholder="math, vocabulary">
        </div>
        <div class="row g-2">
          <div class="col-6">
            <label class="form-label">Number of questions</label>
            <input class="form-control" id="testCount" type="number" min="1" value="10">
          </div>
          <div class="col-6">
            <label class="form-label">Randomize order?</label>
            <select class="form-select" id="testOrder">
              <option value="random">Random</option>
              <option value="sequential">Sequential</option>
            </select>
          </div>
        </div>
        <div class="mt-3 small text-muted">Tests are generated from <strong>flashcards</strong> only. If you have fewer flashcards than the requested number, all available will be used.</div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary" id="startTest">Start Test</button>
      </div>
    </div>
  </div>
</div>

<!-- Test Player Modal -->
<div class="modal fade" id="testPlayerModal" tabindex="-1">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Test</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="testBody">
        <!-- dynamic -->
      </div>
      <div class="modal-footer" id="testFooter">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
// Single-file notes app using localStorage
const STORAGE_KEY = 'notes_manager_storage';
let notes = []; // array of note objects
let currentView = 'list';
let activeTagFilter = null;

function uid(){return 'id_'+Math.random().toString(36).slice(2,10)}

function saveNotes(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
  updateStorageInfo();
}

function loadNotes(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    notes = raw? JSON.parse(raw) : [];
  }catch(e){notes=[]}
}

function updateStorageInfo(){
  const raw = localStorage.getItem(STORAGE_KEY) || '';
  const bytes = new Blob([raw]).size;
  $('#storageInfo').text((notes.length||0)+' notes • '+bytes+' bytes');
}

function allTags(){
  const t = {};
  notes.forEach(n=> (n.tags||[]).forEach(tag=> t[tag]= (t[tag]||0)+1 ));
  return Object.keys(t).sort((a,b)=>t[b]-t[a]);
}

function renderTags(){
  const tags = allTags();
  const $el = $('#tagsList').empty();
  if(tags.length===0) $el.append('<div class="text-muted small">No tags yet</div>');
  tags.forEach(tag=>{
    const count = notes.filter(n=> (n.tags||[]).includes(tag)).length;
    const $b = $(`<span class="badge rounded-pill bg-light text-dark tag-badge" data-tag="${tag}">${tag} <span class="ms-1 small text-muted">${count}</span></span>`)
      .on('click', ()=>{
        if(activeTagFilter===tag){ activeTagFilter=null; $('#viewTitle').text('All Notes'); $('#viewSubtitle').text('Showing everything'); }
        else { activeTagFilter=tag; $('#viewTitle').text('Tag: '+tag); $('#viewSubtitle').text('Filtered by tag'); }
        renderNotes();
      });
    $el.append($b);
  });
}

function renderNotes(){
  const $area = $('#notesArea').empty();
  const q = $('#searchInput').val().toLowerCase().trim();

  let filtered = notes.slice();
  if(activeTagFilter) filtered = filtered.filter(n=> (n.tags||[]).includes(activeTagFilter));
  if(q) filtered = filtered.filter(n=>{
    return (n.title||'').toLowerCase().includes(q) || (n.text||'').toLowerCase().includes(q) || (n.question||'').toLowerCase().includes(q) || (n.tags||[]).join(',').toLowerCase().includes(q);
  });

  // pinned notes first
  filtered.sort((a,b)=> (b.pinned?1:0) - (a.pinned?1:0));

  if(currentView==='list'){
    filtered.forEach(n=>{
      const $card = $(
        `<div class="card mb-3">
          <div class="card-body d-flex justify-content-between align-items-start">
            <div>
              <div class="d-flex align-items-center mb-2">
                <h6 class="mb-0 me-2">${escapeHtml((n.title||n.type).substr(0,80))}</h6>
                <span class="badge bg-secondary note-type-pill text-white me-1">${n.type}</span>
                ${n.pinned?'<i class="fa-solid fa-thumbtack text-warning ms-1" title="Pinned"></i>':''}
              </div>
              <div class="mb-2 text-muted small">${(n.tags||[]).map(t=>'<span class="badge bg-light text-dark me-1 tag-click" data-tag="'+t+'">'+t+'</span>').join(' ')}</div>
              <div>${renderNoteContentPreview(n)}</div>
            </div>
            <div class="text-end">
              <div class="btn-group">
                <button class="btn btn-sm btn-outline-primary btn-edit" data-id="${n.id}"><i class="fa-solid fa-pen"></i></button>
                <button class="btn btn-sm btn-outline-danger btn-delete" data-id="${n.id}"><i class="fa-solid fa-trash"></i></button>
              </div>
            </div>
          </div>
        </div>`);
      $card.find('.tag-click').on('click', function(){ const t=$(this).data('tag'); activeTagFilter=t; $('#viewTitle').text('Tag: '+t); renderNotes(); });
      $card.find('.btn-edit').on('click', ()=>openEdit(n.id));
      $card.find('.btn-delete').on('click', ()=>{ if(confirm('Delete note?')){ notes = notes.filter(x=>x.id!==n.id); saveNotes(); renderAll(); } });
      $area.append($card);
    });
    if(filtered.length===0) $area.append('<div class="text-center text-muted">No notes match.</div>');
  }
  else if(currentView==='table'){
    // show only table-type notes
    const tables = filtered.filter(n=>n.type==='table');
    if(tables.length===0) $area.append('<div class="text-muted">No table notes.</div>');
    tables.forEach(n=>{
      const headers = n.table && n.table.length? Object.keys(n.table[0]) : [];
      const $c = $(`<div class="card mb-3"><div class="card-body"><div class="d-flex justify-content-between"><h6 class="mb-0">${escapeHtml(n.title||'Table')}</h6><div><button class="btn btn-sm btn-outline-primary btn-edit" data-id="${n.id}"><i class="fa-solid fa-pen"></i></button></div></div><div class="mt-2 table-responsive"><table class="table table-sm table-striped table-small"><thead><tr>${headers.map(h=>'<th>'+escapeHtml(h)+'</th>').join('')}</tr></thead><tbody>${n.table.map(row=>'<tr>'+headers.map(h=>'<td>'+escapeHtml(row[h]||'')+'</td>').join('')+'</tr>').join('')}</tbody></table></div></div></div>`);
      $c.find('.btn-edit').on('click', ()=>openEdit(n.id));
      $area.append($c);
    });
  }
  else if(currentView==='flash'){
    const cards = filtered.filter(n=>n.type==='flash');
    if(cards.length===0) $area.append('<div class="text-muted">No flashcards yet.</div>');
    const $grid = $('<div class="row g-3"></div>');
    cards.forEach(n=>{
      const $col = $(`<div class="col-12 col-md-6 col-lg-4"><div class="card card-flip" data-id="${n.id}" style="height:160px;position:relative;"><div class="card-inner"><div class="card-front card-front p-3"><h6 class="mb-2">${escapeHtml(n.question||'Question')}</h6><div class="small text-muted">${(n.tags||[]).map(t=>'<span class="badge bg-light text-dark me-1">'+t+'</span>').join(' ')}</div></div><div class="card-back bg-light p-3"><h6 class="mb-2">Answer</h6><div>${escapeHtml(n.answer||'')}</div></div></div></div></div>`);
      $col.find('.card-flip').on('click', function(){ $(this).toggleClass('flip'); });
      $grid.append($col);
    });
    $area.append($grid);
  }
}

function renderNoteContentPreview(n){
  if(n.type==='point'){
    const lines = (n.text||'').split('\n').slice(0,5);
    return '<ul>'+lines.map(l=>'<li>'+escapeHtml(l)+'</li>').join('')+'</ul>';
  }else if(n.type==='table'){
    const rows = (n.table||[]).slice(0,3);
    if(rows.length===0) return '<div class="text-muted">Empty table</div>';
    const headers = Object.keys(rows[0]);
    return `<div class="table-responsive"><table class="table table-sm table-small"><thead><tr>${headers.map(h=>'<th>'+escapeHtml(h)+'</th>').join('')}</tr></thead><tbody>${rows.map(r=>'<tr>'+headers.map(h=>'<td>'+escapeHtml(r[h]||'')+'</td>').join('')+'</tr>').join('')}</tbody></table></div>`;
  }else if(n.type==='flash'){
    return `<div><strong>Q:</strong> ${escapeHtml((n.question||'')).slice(0,140)}<br><strong>A:</strong> ${escapeHtml((n.answer||'')).slice(0,140)}</div>`;
  }
  return '';
}

function openEdit(id){
  const n = notes.find(x=>x.id===id); if(!n) return alert('Note not found');
  $('#noteId').val(n.id);
  $('#noteType').val(n.type).trigger('change');
  $('#noteTags').val((n.tags||[]).join(', '));
  $('#pinNote').prop('checked', !!n.pinned);
  if(n.type==='point') $('#noteText').val(n.text||'');
  if(n.type==='table') $('#noteTable').val(serializeTable(n.table));
  if(n.type==='flash'){ $('#noteQuestion').val(n.question||''); $('#noteAnswer').val(n.answer||''); }
  $('#noteModal .modal-title').text('Edit Note');
  new bootstrap.Modal(document.getElementById('noteModal')).show();
}

function serializeTable(table){
  if(!table || !table.length) return '';
  const headers = Object.keys(table[0]);
  const rows = table.map(r=> headers.map(h=> (r[h]||'')).join(','));
  return headers.join(',') + '\n' + rows.join('\n');
}

function parseCSV(text){
  const lines = text.split(/\r?\n/).filter(l=>l.trim()!=='');
  if(lines.length===0) return [];
  const headers = lines[0].split(',').map(h=>h.trim());
  return lines.slice(1).map(l=>{
    const cols = l.split(','); const obj = {};
    headers.forEach((h,i)=> obj[h]= (cols[i]||'').trim());
    return obj;
  });
}

function escapeHtml(s){ if(!s) return ''; return $('<div>').text(s).html(); }

$(function(){
  loadNotes(); updateStorageInfo(); renderTags(); renderNotes();

  // View mode buttons
  $('.view-mode').on('click', function(){ $('.view-mode').removeClass('active'); $(this).addClass('active'); currentView=$(this).data('mode'); renderNotes(); });

  // New note
  $('#btnAddNote').on('click', ()=>{
    $('#noteForm')[0].reset(); $('#noteId').val(''); $('#noteType').val('point').trigger('change'); $('#noteModal .modal-title').text('Add Note');
    new bootstrap.Modal(document.getElementById('noteModal')).show();
  });

  $('#noteType').on('change', function(){ const t=$(this).val(); $('#fieldPoint,#fieldTable,#fieldFlash').addClass('d-none'); if(t==='point') $('#fieldPoint').removeClass('d-none'); if(t==='table') $('#fieldTable').removeClass('d-none'); if(t==='flash') $('#fieldFlash').removeClass('d-none'); });

  $('#noteForm').on('submit', function(e){ e.preventDefault();
    const id = $('#noteId').val() || uid();
    const type = $('#noteType').val();
    const tags = $('#noteTags').val().split(',').map(s=>s.trim()).filter(Boolean);
    const pinned = $('#pinNote').prop('checked');
    const base = { id, type, tags, pinned, title: '' };
    if(type==='point'){
      base.text = $('#noteText').val(); base.title = (base.text||'').split('\n')[0] || 'Point';
    } else if(type==='table'){
      const table = parseCSV($('#noteTable').val()||''); base.table = table; base.title = 'Table: '+(table.length?Object.keys(table[0]).join(','):'(empty)');
    } else if(type==='flash'){
      base.question = $('#noteQuestion').val(); base.answer = $('#noteAnswer').val(); base.title = (base.question||'Flashcard');
    }
    // merge or replace if exists
    const idx = notes.findIndex(n=>n.id===id);
    if(idx>=0) notes[idx]= {...notes[idx], ...base}; else notes.push(base);
    saveNotes(); renderAll();
    bootstrap.Modal.getInstance(document.getElementById('noteModal')).hide();
  });

  // search
  $('#searchInput').on('input', function(){ renderNotes(); });

  // click tags in left to fill test tags
  $('#btnTakeTest').on('click', ()=>{ $('#testTags').val(''); new bootstrap.Modal(document.getElementById('testModal')).show(); });

  // import/export
  $('#btnImport').on('click', ()=>{ $('#importText').val(''); new bootstrap.Modal(document.getElementById('importModal')).show(); });
  $('#btnExport').on('click', ()=>{
    const dataStr = JSON.stringify(notes, null, 2);
    const blob = new Blob([dataStr], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'notes_export_'+new Date().toISOString().slice(0,19).replace(/[:T]/g,'_')+'.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });

  $('#doImport').on('click', ()=>{
    const text = $('#importText').val(); if(!text) return alert('Paste JSON to import');
    let parsed; try{ parsed = JSON.parse(text);}catch(e){ return alert('Invalid JSON: '+e.message); }
    if(!Array.isArray(parsed)) return alert('Expected an array of notes');
    const mode = $('input[name=importMode]:checked').val();
    if(mode==='replace'){ notes = parsed.map(normalizeImported); saveNotes(); renderAll(); bootstrap.Modal.getInstance(document.getElementById('importModal')).hide(); return; }
    // merge
    const byId = {}; notes.forEach(n=>byId[n.id]=n);
    parsed.forEach(p=>{ const np = normalizeImported(p); if(!np.id) np.id = uid(); byId[np.id]=np; });
    notes = Object.values(byId); saveNotes(); renderAll(); bootstrap.Modal.getInstance(document.getElementById('importModal')).hide();
  });

  // test start
  $('#startTest').on('click', ()=>{
    const tags = $('#testTags').val().split(',').map(s=>s.trim()).filter(Boolean);
    const count = parseInt($('#testCount').val(),10) || 10;
    const order = $('#testOrder').val();
    let pool = notes.filter(n=>n.type==='flash');
    if(tags.length) pool = pool.filter(n=> tags.some(t=> (n.tags||[]).includes(t)) );
    if(pool.length===0) return alert('No flashcards in selected tags');
    if(order==='random') pool = shuffle(pool);
    pool = pool.slice(0, count);
    startTestPlayer(pool);
    bootstrap.Modal.getInstance(document.getElementById('testModal')).hide();
  });

  // delegate edit/delete from list area
  $(document).on('click', '.btn-delete', function(){ const id=$(this).data('id'); if(confirm('Delete?')){ notes=notes.filter(n=>n.id!==id); saveNotes(); renderAll(); }});

});

function normalizeImported(p){
  return {
    id: p.id || uid(),
    type: p.type || 'point',
    text: p.text || p.text === '' ? p.text : (p.question && p.type!=='flash' ? p.question : ''),
    table: p.table || p._table || (p.csv ? parseCSV(p.csv) : p.table) || [],
    question: p.question || '',
    answer: p.answer || '',
    tags: Array.isArray(p.tags)? p.tags : (typeof p.tags==='string'? p.tags.split(',').map(s=>s.trim()).filter(Boolean):[]),
    pinned: !!p.pinned,
    title: p.title || ''
  };
}

function renderAll(){ renderTags(); renderNotes(); }

function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }

// Test player
function startTestPlayer(cards){
  let index = 0, correct=0, seen=0;
  const total = cards.length;
  const $body = $('#testBody').empty();
  const $footer = $('#testFooter').empty();

  function showCard(i){
    const c = cards[i];
    $body.html(`<div class="d-flex justify-content-between mb-2"><div><strong>Question ${i+1} / ${total}</strong></div><div><small class="text-muted">Tags: ${(c.tags||[]).join(', ')}</small></div></div><div class="card"><div class="card-body"><h5>${escapeHtml(c.question||'')}</h5><div class="mt-3"><button class="btn btn-outline-primary" id="revealAnswer">Reveal Answer</button></div><div id="answerArea" class="mt-3 d-none"><div class="p-3 bg-light"><strong>Answer:</strong><div class="mt-2">${escapeHtml(c.answer||'')}</div></div></div></div></div>`);
    $footer.html(`<div class="d-flex justify-content-between w-100"><div><button class="btn btn-secondary" id="prevBtn">Previous</button></div><div><button class="btn btn-success" id="btnCorrect">I knew it</button> <button class="btn btn-danger" id="btnWrong">I didn't</button></div></div>`);
    if(i===0) $footer.find('#prevBtn').prop('disabled', true);
    $footer.find('#revealAnswer').on('click', ()=>{ $('#answerArea').removeClass('d-none'); });
    $footer.find('#btnCorrect').on('click', ()=>{ correct++; seen++; next(); });
    $footer.find('#btnWrong').on('click', ()=>{ seen++; next(); });
    $footer.find('#prevBtn').on('click', ()=>{ if(index>0){ index--; showCard(index);} });
  }

  function next(){ if(index < total-1){ index++; showCard(index);} else { finish(); } }
  function finish(){ $body.html(`<div class="text-center"><h4>Finished</h4><p>You answered ${correct} out of ${total} as correct.</p><div class="mb-3">Score: <strong>${Math.round((correct/total)*100)}%</strong></div><button class="btn btn-primary" id="closeTest">Close</button></div>`); $footer.empty(); $('#closeTest').on('click', ()=> bootstrap.Modal.getInstance(document.getElementById('testPlayerModal')).hide()); }

  new bootstrap.Modal(document.getElementById('testPlayerModal')).show();
  showCard(index);
}

</script>
</body>
</html>